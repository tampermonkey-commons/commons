class Logger{constructor(e="logger"){this.version="0.5.0",this.name=e}getTime(){var e=new Date;let t=e.getHours()+"",n=(1==t.length&&(t="0"+t),e.getMinutes()+""),i=(1==n.length&&(n="0"+n),e.getSeconds()+""),s=(1==i.length&&(i="0"+i),e.getMilliseconds()+"");return 1==s.length?s="00"+s:2==s.length&&(s="0"+s),`${t}:${n}:${i}.`+s}debug(e,...t){this.log(console.debug,"DEBUG",e,...t)}info(e,...t){this.log(console.info,"INFO",e,...t)}warn(e,...t){this.log(console.warn,"WARN",e,...t)}error(e,...t){this.log(console.error,"ERROR",e,...t)}log(e,t,n,...i){n="%s [%s] %s "+n;null!=i&&0<i.length?e(n,this.getTime(),this.name,t,...i):e(n,this.getTime(),this.name,t)}}class UserScriptConfig{constructor(e="user-script-config"){this.name=e,this.version="0.5.0",this.logger=new Logger(e)}listValues(){return GM_listValues()}containsKey(e){return null!=this.getValue(e,void 0)}getValue(e,t){return GM_getValue(e,t)}setValue(e,t){return GM_setValue(e,t)}getOrInitValue(e,t){let n=this.getValue(e,void 0);return null==n&&(n=t,this.setValue(e,t)),n}deleteValue(e){GM_deleteValue(e)}}class DynamicInjector{constructor(){this.version="0.5.0",this.defaultCDN="https://cdn.jsdelivr.net/npm/",this.logger=new Logger("dynamic-injector")}sleep=t=>new Promise(e=>setTimeout(e,t));getFileExtName(e){var e=new URL(e).pathname,t=e.lastIndexOf(".");return e.substring(t)}async dynamicInjectByUrl(e,t=5e3,n=void 0){var i=this.getFileExtName(e);if(".js"!=i)return".css"==i?((i=document.createElement("link")).href=e,i.rel="stylesheet",document.head.appendChild(i),!0):(this.logger.warn("未识别的资源类型：%s",e),!1);(i=document.createElement("script")).src=e,document.body.appendChild(i);let s=!1;var l,r=new Date;do{if(t<=(new Date).getTime()-r.getTime())return this.logger.warn("动态加载 %s 超时",e),!1;if(await this.sleep(10),null!=n){if(s=n())return l=(new Date).getTime()-r.getTime(),this.logger.debug("动态加载 %s 成功，耗时：%d ms",e,l),!0}else s=!0}while(!s);return s}async dynamicInjectFromCDN(e,t,n,i,s=5e3,l=void 0){let r=t;null!=n&&0<n.length&&(r+="@"+n);t=""+e+r+i;return this.dynamicInjectByUrl(t,s,l)}async dynamicInject(e,t,n,i=5e3,s=void 0){return this.dynamicInjectFromCDN(this.defaultCDN,e,t,n,i,s)}}class Skeleton{constructor(e){this.name=(e.hasOwnProperty("name")?e:GM_info.script).name,this.version=(e.hasOwnProperty("version")?e:GM_info.script).version,this.optionsUrl=e.hasOwnProperty("url")?e.url:null,this.logger=new Logger(this.name),this.injector=new DynamicInjector,this.appNodeId=null,this.injectStyles=null,this.vueVersion=e.hasOwnProperty("vue")?e.vue:null,this.vue=null,this.vueOptions=null,this.vueApp=null,this.elementVersion=e.hasOwnProperty("element")?e.element:null,this.element=null,this.vuexVersion=e.hasOwnProperty("vuex")?e.vuex:null,this.vuex=null,this.storeOptions=null}async dynamicInjectVue(){let e=!1,t=this;if(null!=this.vueVersion&&!(e=await this.injector.dynamicInject("vue",this.vueVersion,"/dist/vue.global.prod.js",5e3,()=>{if("undefined"!=typeof Vue)return t.vue=Vue,t.logger.info("Vue %s Loaded.",t.vue.version),!0})))return e;if(null!=this.elementVersion){if(!(e=await this.injector.dynamicInject("element-plus",this.elementVersion,"/dist/index.full.min.js",5e3,()=>{if("undefined"!=typeof ElementPlus)return t.element=ElementPlus,t.logger.info("Element Plus %s Loaded.",t.element.version),!0})))return e;this.injector.dynamicInject("element-plus",this.elementVersion,"/dist/index.min.css")}return!(null!=this.vuexVersion&&!(e=await this.injector.dynamicInject("vuex",this.vuexVersion,"/dist/vuex.global.min.js",5e3,()=>{if("undefined"!=typeof Vuex)return t.vuex=Vuex,t.logger.info("Vuex %s Loaded.",t.vuex.version),!0})))||e}async dynamicInjectOptions(e,n=void 0){if(null==n){let t=this;n=()=>{let e=0;return"undefined"!=typeof appNodeId&&(t.appNodeId=appNodeId,e++),"undefined"!=typeof vueAppOptions&&(t.vueOptions=vueAppOptions,e++),"undefined"!=typeof storeOptions&&(t.storeOptions=storeOptions,e++),"undefined"!=typeof injectStyles&&(t.injectStyles=injectStyles,e++),0<e}}return await this.injector.dynamicInjectByUrl(e,5e3,n)}async createVueApp(e){var t;return!!await this.dynamicInjectVue()&&!!await this.dynamicInjectOptions(e)&&(null==(e=document.getElementById(this.appNodeId))&&((e=document.createElement("div")).id=this.appNodeId,document.body.appendChild(e)),e=this.vue.createApp(this.vueOptions),null!=this.element&&e.use(this.element),null!=this.storeOptions&&(t=this.vuex.createStore(this.storeOptions),e.use(t)),e.mount("#"+this.appNodeId),this.vueApp=e,!0)}async start(){this.createVueApp(this.optionsUrl)}}